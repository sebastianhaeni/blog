{"componentChunkName":"component---src-templates-blog-post-js","path":"/0006-forecasting-at-scale-content/","result":{"data":{"site":{"siteMetadata":{"title":"Blog of Sebastian Häni"}},"markdownRemark":{"id":"e604cde9-a5ca-5089-b327-6536cd27a518","excerpt":"This is my third blog post about the paper \n Sean J. Taylor & Benjamin Letham (2018) “Forecasting at Scale”, The American Statistician. I’m going to focus on…","html":"<p>This is my third blog post about the paper\n<span style=\"font-size: 1.2em\"> <em><a href=\"https://amstat.tandfonline.com/doi/full/10.1080/00031305.2017.1380080\">Sean J. Taylor &#x26; Benjamin Letham (2018) “Forecasting at Scale”, The American Statistician</a></em>.</span></p>\n<p>I’m going to focus on its contents and try to place it in the field of forecasting and business time series.</p>\n<h2>Business Time Series</h2>\n<p>Most large corporations process a lot of interesting data in the form of Business Time Series. These can be customer\nrelated such as purchases, interactions through consultations, support, incident reports, usage of the service and so\non. They can also be about internal processes that cannot be attributed to a single customer, such as infrastructure\nproviding services to multiple customers.</p>\n<p>These time series can provide insights on how the company performed in the past but also provide the foundation to\ncreate forecasts. The paper “Forecasting at Scale” provides the reader with practices proofed in\nthe real world because they have been applied at Facebook. If the proposed methods work outside of Facebook and are\napplicable to other organizations has to be found out. </p>\n<h2>Preliminary reading</h2>\n<p>I’m going to list a few topics that you should be familiar with in case you decide to read the paper.</p>\n<ul>\n<li>Linear Regression, Advanced Regression Methods, Exponential Smoothing Methods, Bayesian Statistics, Fourier Series,\n<a href=\"http://bit.ly/stl1990\">STL</a></li>\n</ul>\n<p>If you want to reproduce the results of the paper, I recommend you are familiar with:</p>\n<ul>\n<li><a href=\"https://www.jstatsoft.org/article/view/v076i01\">Stan</a>, <a href=\"https://www.r-project.org/\">R</a>, <a href=\"https://shiny.rstudio.com/\">Shiny</a></li>\n</ul>\n<h2>Assembly of Ideas</h2>\n<p>The paper has the main idea to assemble several methods into a scalable forecasting system. So what are the ideas\nthat the authors have assembled to build this system of scale?</p>\n<ul>\n<li>A forecasting model</li>\n<li>Automatic evaluation of forecasts</li>\n</ul>\n<h2>The <a href=\"https://facebook.github.io/prophet/\">Prophet</a> Forecasting Model</h2>\n<p>As we know from the STL paper (Seasonal and Trend Decomposition using Loess), one can try to decompose a time series\ninto trend and seasonality components using Loess regression. </p>\n<p><strong>Trend</strong></p>\n<p>The mathematical expression to compute the nonlinear, saturating growth trend in its most basic form is </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 231px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/d029996fabeb08c81a77b61057e13934/6e622/standard-trend.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.027027027027025%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAAnklEQVQY051PywrEIBDr/39cD6IUTz0IRezDg/ZFbbNkoD0sy8LuwDCPZGKs8EN0XYdpmr5yquM4oJSCMQZ938M5h3VdkVJCzhnLsmDbNqnjOCLGiHmeBWeSSx7reZ6oSG7b9gFLKY8wHVlrUde1PDoMg/RaaxGnW+45ExOHn2zfjvZ9F2LTNCJ+XZfMIQTp+Tvvvex4I4IE3vPf4O0L0S2CES/zpZ4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"standard trend formula\"\n        title=\"standard trend formula\"\n        src=\"/blog/static/d029996fabeb08c81a77b61057e13934/6e622/standard-trend.png\"\n        srcset=\"/blog/static/d029996fabeb08c81a77b61057e13934/12f09/standard-trend.png 148w,\n/blog/static/d029996fabeb08c81a77b61057e13934/6e622/standard-trend.png 231w\"\n        sizes=\"(max-width: 231px) 100vw, 231px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>with C the carrying capacity, k the growth rate, and m an offset parameter.</p>\n<p>This gives us a formula that supports a static carrying capacity and static growth rate. In the real world capacity and\ngrowth rate are often not static and need to be dynamic. We can replace the carrying\ncapacity with an analyst-specified dynamic capacity function based on time. The growth rate can be replaced with a vector that contains the\nmanually specified change points with the respective growth rate of that time interval. This gives us the new formula</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 394px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/641cd764309092ad650cba14986ab45d/cc097/prophet-trend.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.864864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAfklEQVQI132OQQrFIAxEvf/9XIqCFmqrWBVFqHX+T6DbBkIy8DIZgX89z4O1Fr6KmBgjxhifnKi1whiD67pQSkFKCed58jH1u2/bBikl9n1n7jgOZr33CCHwJC3mnLjvm91ba8g5QykF5xyDZEhmpK21rHvvrCkEhaEnWmvmf2C75XhYP5Z1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"prophet trend formula\"\n        title=\"prophet trend formula\"\n        src=\"/blog/static/641cd764309092ad650cba14986ab45d/cc097/prophet-trend.png\"\n        srcset=\"/blog/static/641cd764309092ad650cba14986ab45d/12f09/prophet-trend.png 148w,\n/blog/static/641cd764309092ad650cba14986ab45d/e4a3f/prophet-trend.png 295w,\n/blog/static/641cd764309092ad650cba14986ab45d/cc097/prophet-trend.png 394w\"\n        sizes=\"(max-width: 394px) 100vw, 394px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Sometimes we only need a piecewise linear model. This formula can be reused when simplified. It will give us a linear trend\nwith change points by removing the carrying capacity, and a constant growth replaced by rate adjustments.</p>\n<p>The uncertainty of this model is computed by using it generatively, after having inferred the model parameters, to\nforecast the future, while assuming the rate of change points is going to have a similar average cadence. We can repeat\nthe generation while sampling the model parameters from a Laplace distribution and create an uncertainty region.</p>\n<p><strong>Seasonality</strong></p>\n<p>Since seasonality in the real world is mostly a composition and does not have a fixed window in which it repeats, it\ncan be flexibly modeled using Fourier series. If we have different components for different periodic effects, such as\nyearly, holiday or weekday components, we can create an additive model based on that.</p>\n<p>A standard Fourier series can approximate arbitrary smooth seasonal effects with:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 547px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/ac5c908c168ba5ef997f01b18523d9c3/977f7/fourier-series.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAAj0lEQVQY021PQQrEIAz0/w/04MUqWkWtoHiwWJolWSxd2UAMM5k4CYMlaq1w3/cPd54n5cq/e9d1EWb4xBih9w7HccC2beCco49LKbDvOwghQClFPHKYqLXWkl5K+fQZunrvobVGlXNOAjQJIdAQ1olzzpBSomGt9YNRZ4z5bjgD10bBGANWHo3/nTx78+QPzeoztPZylIoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fourier series\"\n        title=\"fourier series\"\n        src=\"/blog/static/ac5c908c168ba5ef997f01b18523d9c3/977f7/fourier-series.png\"\n        srcset=\"/blog/static/ac5c908c168ba5ef997f01b18523d9c3/12f09/fourier-series.png 148w,\n/blog/static/ac5c908c168ba5ef997f01b18523d9c3/e4a3f/fourier-series.png 295w,\n/blog/static/ac5c908c168ba5ef997f01b18523d9c3/977f7/fourier-series.png 547w\"\n        sizes=\"(max-width: 547px) 100vw, 547px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><strong>Fitting</strong></p>\n<p>The complete model can be fitted in Stan:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/9d3e6c354770300c8a2f03d1616d29d2/5d030/model-stan.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAAB4UlEQVQ4y4VUCXKDMBDj/09sZ5qk3JcNGJsb1doUpk0yLTMbH8FaSbsm0Frj9nlDrWq4ccC2bxJ89n0/41j/9wT7tsOMFqXVKJySGJbxCeAV+KsEAX/6vsc4jiDbKI6QpimappE9jtu2/Tr0E/wxiQC2bQvrLKqqQhiGAkhwJlJKYV1XOfAI/JjkZEig6/UqQMYYAYrjGFF0Z1uWpTDlexynaZIkwzBgnudnhkVR4HK5yMuDLwxZck2wxAeTfVw+kGWZMGbQjrquhcDB/AQkI600tnXDNE4yb7QHdwOWaYbrfdGKUg7/JfeUPO8LzOJQDhpq6tCtDuM+o/Jr7hWDgp7Nn/4dcWfoetjBIdMl4iJBWuZQrZZ2Ukaj6tR97qVaa+Gcw7IsIpvx1DY0uPOVztMMaZKKZOttcNaJDZTfdR2SJJHq00v6yjXtYmGYiMUKDv2938jzHJEviP2ex0kM5Y1XtTqrySCrA4BkWBQy5lwYOn8z1OgZmAKfbYraNbjpBGHjmegYYZv56/j/tTslW++J3BTfNmmeSb91pvOse5ieYc4+pGQyYw/yDEf+dygISJdBj4wP+vP+9i7+8CD9Y7scjU6p6Xdv8gxBKPesMjMQ8PDymD9+BH7u8R369erj8AXJnYx+IXqurwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"model-stan\"\n        title=\"model-stan\"\n        src=\"/blog/static/9d3e6c354770300c8a2f03d1616d29d2/fcda8/model-stan.png\"\n        srcset=\"/blog/static/9d3e6c354770300c8a2f03d1616d29d2/12f09/model-stan.png 148w,\n/blog/static/9d3e6c354770300c8a2f03d1616d29d2/e4a3f/model-stan.png 295w,\n/blog/static/9d3e6c354770300c8a2f03d1616d29d2/fcda8/model-stan.png 590w,\n/blog/static/9d3e6c354770300c8a2f03d1616d29d2/5d030/model-stan.png 771w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The analyst creating a fit has to tweak the model parameters to reach the right compromise between loss and\noverfitting. An analyst has settings to adjust capacities (C), change points (X), holidays and seasonality (A, gamma) and\nsmoothing parameters (tau, sigma). Often times this requires a broad experience in the business field to come up with\ngood model parameters. This can for example be because the analyst has to have a feeling for the impact of an upcoming\nholiday in terms of trend or seasonality change.</p>\n<p>The analyst is supported by visualization that show the effects of the latest changes to their model:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/0f9620ade15b6088a67b4c8c8b251c6f/eb2af/fit-viz.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.486486486486484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABVElEQVQoz1VRXW+DMAzk//+X/YM9bS97mLZKndDU7xZ1pSEBlgSSEOBmp6q2IVnxJfjubGegbxiGfzHGCMwzpjH+3v3JOcIQ4LxDpH9718Nay1TIOOm6Dm3bomkadIQr2eD5bYWyaqg4IIQAozvEIaacCatKojOWhEZ6sygvJaZpQlaWJfS3Rl3XRCTR1g22lzMeXp+QH3eQVCiVwkv+icX6ACkVWhLOdwe8r08wvYP3A4SQqYtMEokxBlrr5FBrg+Jrh+XyEcVpA0VC4nrFep9jsfmAqCooEjid98iLFWxvEahtoSQGcp8JIVL/bNfTTPreE1ZwXUHt14T7JNZZgeq6TeKGWvWuhWmPNAYHFz1Uq9I8M54BFzHgnG2HMBCeEccp3d2Wwm8+5c65hKfpvkQ2onmPyHgzvBQmvRWNyQW7Zdf8xnO+C/LJjvmMcUwxE9M9fgB00hm+z2lemwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fit visualization\"\n        title=\"fit visualization\"\n        src=\"/blog/static/0f9620ade15b6088a67b4c8c8b251c6f/fcda8/fit-viz.png\"\n        srcset=\"/blog/static/0f9620ade15b6088a67b4c8c8b251c6f/12f09/fit-viz.png 148w,\n/blog/static/0f9620ade15b6088a67b4c8c8b251c6f/e4a3f/fit-viz.png 295w,\n/blog/static/0f9620ade15b6088a67b4c8c8b251c6f/fcda8/fit-viz.png 590w,\n/blog/static/0f9620ade15b6088a67b4c8c8b251c6f/efc66/fit-viz.png 885w,\n/blog/static/0f9620ade15b6088a67b4c8c8b251c6f/eb2af/fit-viz.png 954w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Automatic Evaluation of Forecasts</h2>\n<p>The analyst can optimize a model given time. If there are too many forecasts that have to be produced that can be\nhandled by humans, the automatic evaluation of forecasts comes into play.</p>\n<p>The metric used to compare models is the mean absolute percentage error (MAPE) over a number of forecasts produced with\ndifferent prediction horizons.</p>\n<p>Time series data points are inherently dependent on previous points. This is making it hard to use traditional methods\nsuch as cross-validation. The method proposed is Simulated Historical Forecasts (SHFs), that produce K forecasts at\nvarious cutoff points in the history. The generally used amount of points is a forecast every H/2 periods. This allows\nthe model to produce an error term using MAPE which can be compared to baseline models. </p>\n<p>Time series data usually encompasses a lot of data points and running SHFs with the maximum amount of periods would not\nbe feasible as the model needs to be retrained each time. With SHFs, the simulation count is significantly reduced and\nthe computation can be run independent on separate machines.</p>\n<h2>Paper Context</h2>\n<p>The paper “Forecasting at Scale”, picks up common knowledge that the field of business time series has been using for\nquite some time but mix it with other techniques to solve new challenges while making it scalable and allowing the\nanalyst to be in the loop.</p>\n<p>In my opinion the value the paper creates in the field is not the paper, but the companioning library <a href=\"https://facebook.github.io/prophet/\">Prophet</a> which\nmakes all those techniques readily usable for a broader audience. The paper is worth a read if you’re going to use the\nlibrary. If you’re not planning that have a go with it, I can still recommend it as there might be some smallish novel\nideas introduced that you might find interesting. If you are already well versed in the time series field, I would say\nthat this paper is not going to contain much new for you. </p>\n<h2>Paper Follow ups</h2>\n<p>The library <a href=\"https://facebook.github.io/prophet/\">Prophet</a> is under active development for over a year now. The open source community contributes to future\nimprovements to the code. The basic methods mentioned in the paper implemented haven’t been changed though. So I’m\nguessing that they are a good fit for the real world.</p>","fields":{"slug":"/0006-forecasting-at-scale-content/"},"frontmatter":{"title":"How to Forecast at Scale","date":"May 12, 2020","description":null,"tags":["MSc","AI Seminar"]}}},"pageContext":{"slug":"/0006-forecasting-at-scale-content/","previous":{"fields":{"slug":"/0005-keep-your-dependencies-up-to-date/"},"frontmatter":{"title":"Automatically keep your dependencies up to date in closed source projects for free","tags":["DevOps","Jenkins","NPM","Gradle"]}},"next":{"fields":{"slug":"/0007-forecasting-at-scale-review/"},"frontmatter":{"title":"A Review of Forecast at Scale","tags":["MSc","AI Seminar"]}}}}}