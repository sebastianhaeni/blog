<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:118.75%/1.58 'Lora',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.73);font-family:'Lora',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;color:hsla(0,0%,0%,0.9);font-family:'Varela Round',sans-serif;font-weight:400;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;color:hsla(0,0%,0%,0.9);font-family:'Varela Round',sans-serif;font-weight:400;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;color:hsla(0,0%,0%,0.9);font-family:'Varela Round',sans-serif;font-weight:400;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;color:hsla(0,0%,0%,0.9);font-family:'Varela Round',sans-serif;font-weight:400;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;color:hsla(0,0%,0%,0.9);font-family:'Varela Round',sans-serif;font-weight:400;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;color:hsla(0,0%,0%,0.9);font-family:'Varela Round',sans-serif;font-weight:400;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}ul{margin-left:1.58rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.58rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;font-size:0.85rem;line-height:1.58rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;font-size:1rem;line-height:1.58rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}blockquote{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0.9875rem;padding-right:0;padding-top:0;margin-bottom:1.58rem;font-size:1.1487rem;line-height:1.58rem;border-left:0.5925rem solid #134896;color:hsla(0,0%,0%,0.65);font-style:italic;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.58rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.58rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.58rem;margin-bottom:calc(1.58rem / 2);margin-top:calc(1.58rem / 2);}li > ul{margin-left:1.58rem;margin-bottom:calc(1.58rem / 2);margin-top:calc(1.58rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.58rem / 2);}code{font-size:0.85rem;line-height:1.58rem;}kbd{font-size:0.85rem;line-height:1.58rem;}samp{font-size:0.85rem;line-height:1.58rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.05333rem;padding-right:1.05333rem;padding-top:0.79rem;padding-bottom:calc(0.79rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:#134896;text-decoration:none;text-shadow:.03em 0 #fff,-.03em 0 #fff,0 .03em #fff,0 -.03em #fff,.06em 0 #fff,-.06em 0 #fff,.09em 0 #fff,-.09em 0 #fff,.12em 0 #fff,-.12em 0 #fff,.15em 0 #fff,-.15em 0 #fff;background-image:linear-gradient(to top, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0) 1px, #134896 1px, #134896 2px, rgba(0, 0, 0, 0) 2px);}a:hover,a:active{text-shadow:none;background-image:none;}h1,h2,h3,h4,h5,h6{margin-top:2.37rem;margin-bottom:0.79rem;}li>ol,li>ul{margin-left:20px;margin-bottom:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.58rem;color:hsla(0,0%,0%,0.73);font-style:normal;font-weight:400;}blockquote cite:before{content:"— ";}@media only screen and (max-width:480px){html{font-size:106.25%;line-height:28px;}blockquote{border-left:0.29625rem solid #134896;color:hsla(0,0%,0%,0.59);padding-left:0.88875rem;font-style:italic;margin-left:-1.185rem;margin-right:0;}}</style><meta name="generator" content="Gatsby 5.13.4"/><meta name="theme-color" content="#663399"/><style data-href="/blog/styles.204986e8d4d0f74c3292.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}code[class*=language-],pre[class*=language-]{font-size:medium}.gatsby-highlight code[class*=language-],.gatsby-highlight pre[class*=language-]{font-size:.8em}.anchor{background-image:none}</style><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><link rel="alternate" type="application/rss+xml" title="Blog of Sebastian Häni" href="/blog/rss.xml"/><link rel="icon" href="/blog/favicon-32x32.png?v=b4ad523f144d7d9048b92d580ba7b53d" type="image/png"/><link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/blog/icons/icon-48x48.png?v=b4ad523f144d7d9048b92d580ba7b53d"/><link rel="apple-touch-icon" sizes="72x72" href="/blog/icons/icon-72x72.png?v=b4ad523f144d7d9048b92d580ba7b53d"/><link rel="apple-touch-icon" sizes="96x96" href="/blog/icons/icon-96x96.png?v=b4ad523f144d7d9048b92d580ba7b53d"/><link rel="apple-touch-icon" sizes="144x144" href="/blog/icons/icon-144x144.png?v=b4ad523f144d7d9048b92d580ba7b53d"/><link rel="apple-touch-icon" sizes="192x192" href="/blog/icons/icon-192x192.png?v=b4ad523f144d7d9048b92d580ba7b53d"/><link rel="apple-touch-icon" sizes="256x256" href="/blog/icons/icon-256x256.png?v=b4ad523f144d7d9048b92d580ba7b53d"/><link rel="apple-touch-icon" sizes="384x384" href="/blog/icons/icon-384x384.png?v=b4ad523f144d7d9048b92d580ba7b53d"/><link rel="apple-touch-icon" sizes="512x512" href="/blog/icons/icon-512x512.png?v=b4ad523f144d7d9048b92d580ba7b53d"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:37.92rem;padding:2.37rem 1.185rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/blog/">Blog of Sebastian Häni</a></h3></header><main><article><header><h1 style="margin-top:1.58rem;margin-bottom:0">Introduction to Distributed Tracing</h1><p style="font-size:0.87055rem;line-height:1.58rem;display:block;margin-bottom:1.58rem">July 10, 2022<!-- --> | <a href="/blog/tags/dev-ops/">DevOps</a>, <a href="/blog/tags/tracing/">Tracing</a>, <a href="/blog/tags/monitoring/">Monitoring</a> | <span class="disqus-comment-count" data-disqus-identifier="fd93e217-052a-5b9a-8efd-fdd7ebf88de5" data-disqus-url="https://sebastianhaeni.github.com/blog/0012-distributed-tracing/">...</span></p></header><section><h2 id="distributed-tracing" style="position:relative;"><a href="#distributed-tracing" aria-label="distributed tracing permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Distributed Tracing</h2>
<p>Distributed Tracing enables us to follow invocations across services and monitor them. We can observe a single service using logs and metrics. But what if we have a chain of services that fulfill a single purpose for an end user? For example if we have a user that clicks on an order button in a web frontend, we call the frontend’s backend BFF (I personally favour the <strong>B</strong>ackend-<strong>f</strong>or-<strong>F</strong>rontend pattern) which internally calls an inventory microservice to see if the product is available, and also calls a billing microservice to get the user’s bill they will need to approve. If the billing service returns an error, the BFF returns an error to the user. However the inventory microservice returned a successful response. If we only have logs and metrics, we do not know what we just described, we simply know there were some errors, but their correlation is not given. With tracing we know that an error in a service very likely lead to another error in the consumer service if they are in the same recorded trace.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 64.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACbklEQVR42l1Sy24SURieh/MxjBsXvoFJ040rdy66Mi5aNW00lgSrJUGwkCalhSkCw9yAYbgMZ+5XLnM69zkesG3Ub/Fvznf7/xwCPSDPczx5nqf6VI/qkSRJ0zTLsoIgDIfDdrtNURSE8JGJQaB/kadZDsNwA0c7DfbiOG40Gk2nU8dx/iMTf5zWO2w2a8ddGcZKN1aqqs5ms/k9JF3Xcazv+3c7ZFm2FWNlFEWYugCytABzCWiabppGmqb3XbIsTRNZVgAAkiSpioLJYRhuxdjNMIw4SR7LZFt2mu8aZWkCZMu03L/bJg9kYmma7lh0BW66iJ/t589foT7tbWw9C0KcGQd3QFRAl4qWLorjPIrxNABIIMzjmEC2bd+0kCWdFODBW+flnvNiH+8DE83EYhSFOkmZrBgZTqTb0WyWQ5gFQe55aLMhMtOMFwul10fatF26fvJ02bk0kDxZdbqBrqMoyqS5xgkOP5ZJnjsro4mYAgAZZs3zRK6qkON0foBmfOHD/OCNhFR+fXmlkSS+OC4ZMcxyPHZ51qdZ75bx+sO007EaDYOmiUiSzNtbb75A/K9K0Xi91/QuSsvyD7VcDmQZJzutljMW/dEopHrLy3r/FL9W1FLJI0nCl2X15kapVuelEn1yPPv8aXB4uKxU+KMjXxBQmqrtNqjVtGp1+OWU+fi+8+5Y//pNKhTk83Mis+3YcTbNpsswWr0uFYvy9bXd62m1midJCMLE8wK8IU1breakeMZ8rzs0bTQa8tUVIbIsEMVg9/XyIPRNy9b1brPZrdVcy3JUdcAwK0XZXj5LfWetKrYw4Ns/L0bd7m/ZZbP2tLcuAAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Tracing"
        title=""
        src="/static/823be77aa194870b0ca3596b17d0b293/fcda8/tracing.png"
        srcset="/static/823be77aa194870b0ca3596b17d0b293/12f09/tracing.png 148w,
/static/823be77aa194870b0ca3596b17d0b293/e4a3f/tracing.png 295w,
/static/823be77aa194870b0ca3596b17d0b293/fcda8/tracing.png 590w,
/static/823be77aa194870b0ca3596b17d0b293/efc66/tracing.png 885w,
/static/823be77aa194870b0ca3596b17d0b293/59000/tracing.png 917w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span>
Source: <a href="https://medium.com/nikeengineering/hit-the-ground-running-with-distributed-tracing-core-concepts-ff5ad47c7058">https://medium.com/nikeengineering/hit-the-ground-running-with-distributed-tracing-core-concepts-ff5ad47c7058</a></p>
<p>A trace has an ID and consists of one or more spans. A span has an ID, timestamp, duration, a local and a remote endpoint as well as a name. For REST calls we traditionally use the HTTP method and path as the span name, e.g. <code class="language-text">GET /info</code>. So, how can we collect spans that form a trace from different services running in different containers? The service that starts a trace is generating a trace ID and with every request it creates in the trace context, it not only creates a span, but it also sends the generated trace ID as an HTTP header. Zipkin specified the span propagation headers first and termed them <code class="language-text">B3</code>.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">   Client Tracer                                                  Server Tracer
┌───────────────────────┐                                       ┌───────────────────────┐
│                       │                                       │                       │
│   TraceContext        │          Http Request Headers         │   TraceContext        │
│ ┌───────────────────┐ │         ┌───────────────────┐         │ ┌───────────────────┐ │
│ │ TraceId           │ │         │ X-B3-TraceId      │         │ │ TraceId           │ │
│ │                   │ │         │                   │         │ │                   │ │
│ │ ParentSpanId      │ │ Inject  │ X-B3-ParentSpanId │ Extract │ │ ParentSpanId      │ │
│ │                   ├─┼────────>│                   ├─────────┼>│                   │ │
│ │ SpanId            │ │         │ X-B3-SpanId       │         │ │ SpanId            │ │
│ │                   │ │         │                   │         │ │                   │ │
│ │ Sampling decision │ │         │ X-B3-Sampled      │         │ │ Sampling decision │ │
│ └───────────────────┘ │         └───────────────────┘         │ └───────────────────┘ │
│                       │                                       │                       │
└───────────────────────┘                                       └───────────────────────┘</code></pre></div>
<p>See <a href="https://github.com/openzipkin/b3-propagation">B3-Propagation</a> to learn more about B3 headers. Other vendors followed suit with their propagation format, which meant there were suddenly multiple out there. Nowadays, it’s best practice to follow the <a href="https://www.w3.org/TR/trace-context/">Trace Context W3C Recommendation</a>. If unsure, or during migrations, you can include different propagation headers in your requests, as they don’t bite each other.</p>
<p>The service answering this request picks up the headers and does not generate a new trace ID, but instead uses the provided trace ID. If this service calls yet another service, it simply passes on the trace ID it received. This is handled by instrumentation libraries and a developer usually does not have to care about this, except configuring the tracer library. OpenTelemetry provides state of the art implementation libraries that we can use. They provide compatibility to OpenTelemetry Collector, Prometheus, Jaeger and many others and support different transports (TCP, gRPC, UDP) and different deployment models (in-application, agent, …).</p>
<p>So, each service now knows to which trace its spans belong to, but how do we collect this information? This is where the Collector comes in. We could tell our services to send the spans to an OpenTelemetry Collector or to a Jaeger collector or any other collector that we’d like. Given the common trace ID, the tracing backend can then correlate the spans together and display them in a single timeline. Sending spans in batches to a collector can impact your service’s performance, so there are options to also do this using a sidecar / agent approach, which involves running another process on the same host next to the service container or even a process running in the same container using process daemons.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/fdf486d007afca44e1ebe7c8504a8860/29114/trace.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 55.4054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABS0lEQVR42p2SXWvCMBSG+//vvZhX64f+D2+EjcHuBVEZ2qapNmlqTdqm704zFTdx0x14OOGEPLwJ8YbDJzuZTOx0OrWDwcBGUWR9/9kGgX8kcPi+b0PqjjCwURjaERG6uW/Ho5Ed01mvbmpU+z2qqkLXdeirw1f/rWpCH7shGqKl895iucRmvUZZliiVgpASb6sVXo+8LBaOfj1POZJcIBESiSwQU//ItljTbCOIXQ6vFzDGXEJjDIzWKERKsDNKppB5glzuoIyG0geigm7rq+SezHdISahJpknWc7r61TVVjkpwNI1GbfZoG+Me5xKvICFPmUv3l9BJqxKW0t0qT4kcGU/vFjrpgdLdkLqE2yx7SNjvtpS0F+vOfhcyzsESdpbdK+xrlUnMePFDSF8hjuN/C98324sJCTn9I07SR4SnahuLWSIw36mz8BPh+0cdgRRY/wAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Jaeger Trace"
        title=""
        src="/static/fdf486d007afca44e1ebe7c8504a8860/fcda8/trace.png"
        srcset="/static/fdf486d007afca44e1ebe7c8504a8860/12f09/trace.png 148w,
/static/fdf486d007afca44e1ebe7c8504a8860/e4a3f/trace.png 295w,
/static/fdf486d007afca44e1ebe7c8504a8860/fcda8/trace.png 590w,
/static/fdf486d007afca44e1ebe7c8504a8860/efc66/trace.png 885w,
/static/fdf486d007afca44e1ebe7c8504a8860/c83ae/trace.png 1180w,
/static/fdf486d007afca44e1ebe7c8504a8860/29114/trace.png 1920w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>Tracing data is complementary to logs and metrics and does not replace them.</p>
<p>Using tracing data, we can also visualize system architectures based on actual data in realtime. Especially with microservices and with chaos engineering, your system architecture diagrams will quickly be outdated. We can analyze the local and remote endpoints of each span and determine the direction of communication between two services. Aggregated over all spans we get a dependency map. If we index this data we can even query for the map during a time frame and even visualize throughput and error rates on edges between services.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4836c3812a19deefa75c7129c113d2a9/d9ed5/jaeger-dag-graph.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABNklEQVR42pWSTW6DMBCFuWuMRNWyaJa5CBfIOVjkBs0F2l1KEASM+TF/r28QQSyCREeyMIznm3nPOJ7nIQgCfF2vCMMQn8cj3vnt43SCf7ng7XyGOhzguu6ylOJTKe7V/K7g+/60nGEY0DQNamthuw4YRyzR9wDz/wlnz6GRTYZVo7SqUNQ1Bmm4B2g4bZRlaFgo048zrCfAMte0LTrux7WaTSAPVewuBR0LK0IN18/9Dq01OtryCrQJLDmRQAQm0/QE6DxHRphlTiaWXF5WyHlO8v1KurP2SSLSBZI0RVEUKI1BTNgtSQixE0yiZaOEDUxjJx/XE29eikgTgMjVBMuUURzj+zdCVWhkZYlyVrAJfH6+5Rrp47FIfsoSX6WB2NLL77TrUkQSC6Vgy/yE/hnx8sUF/QFBzvXXTAd1AQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Jaeger Directed Acyclic Graph"
        title=""
        src="/static/4836c3812a19deefa75c7129c113d2a9/fcda8/jaeger-dag-graph.png"
        srcset="/static/4836c3812a19deefa75c7129c113d2a9/12f09/jaeger-dag-graph.png 148w,
/static/4836c3812a19deefa75c7129c113d2a9/e4a3f/jaeger-dag-graph.png 295w,
/static/4836c3812a19deefa75c7129c113d2a9/fcda8/jaeger-dag-graph.png 590w,
/static/4836c3812a19deefa75c7129c113d2a9/efc66/jaeger-dag-graph.png 885w,
/static/4836c3812a19deefa75c7129c113d2a9/c83ae/jaeger-dag-graph.png 1180w,
/static/4836c3812a19deefa75c7129c113d2a9/d9ed5/jaeger-dag-graph.png 2880w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h2 id="tools" style="position:relative;"><a href="#tools" aria-label="tools permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tools</h2>
<p><strong>Instrumentation:</strong></p>
<ul>
<li><a href="https://opentelemetry.io/registry/?component=instrumentation">OpenTelemetry Instrumentation</a> <strong>*recommended</strong></li>
<li><a href="https://www.jaegertracing.io/docs/1.36/client-libraries/">Jaeger</a> - deprecated</li>
<li><a href="https://zipkin.io/pages/tracers_instrumentation.html">Zipkin</a> - deprecated</li>
<li><a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-api.html">AWS X-Ray</a></li>
</ul>
<p><strong>Collecting:</strong></p>
<ul>
<li><a href="https://opentelemetry.io/docs/collector/">OpenTelemetry Collector</a> <strong>*recommended</strong></li>
<li><a href="https://www.jaegertracing.io/">Jaeger</a> - preferred over Zipkin</li>
<li><a href="https://zipkin.io/">Zipkin</a> - first one to be widely adopted</li>
<li><a href="https://docs.aws.amazon.com/xray/">AWS X-Ray</a> - if you’re running services on AWS</li>
</ul>
<p><strong>Analysis / Post-Processing:</strong></p>
<ul>
<li><a href="https://www.jaegertracing.io/">Jaeger</a> - supports wide range of storage backends, decent UI <strong>*recommended</strong></li>
<li><a href="https://zipkin.io/">Zipkin</a> - first one to be widely adopted, scaling issues, UI bugs</li>
<li><a href="https://docs.aws.amazon.com/xray/">AWS X-Ray</a> - if you’re running services on AWS, automatic integration into lots of AWS services</li>
</ul>
<p>Others: <a href="https://tanzu.vmware.com/observability">Tanzu Observability</a>, <a href="https://www.dynatrace.com/">Dynatrace</a>, <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview">Azure Application Insights</a>, <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/overview">Azure Monitor</a>, <a href="https://graphiteapp.org/">Graphite</a>, <a href="https://www.datadoghq.com/">Datadog</a>, <a href="https://cloud.google.com/monitoring">Google Cloud Monitoring</a>, <a href="https://lightstep.com/">Lightstep</a>, <a href="https://logz.io/">Logz.io</a>, <a href="https://sentry.io/">Sentry</a>, <a href="https://www.splunk.com/en_us/products/apm-application-performance-monitoring.html">Splunk APM</a></p>
<h2 id="system-architecture" style="position:relative;"><a href="#system-architecture" aria-label="system architecture permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>System Architecture</h2>
<p>My personally recommended architecture looks like this:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/571735106220a0a56f3c49713cc1083f/460fa/architecture.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 29.72972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABK0lEQVR42oVRzUrDQBDOQ/kUnn0KryLePXjsRQ+CD1FQsA+gECy2xbQUNJaCrW1aTdNkk+xmf/I5uzXirQMfM7M7O/PNtx5qAxi9Q12jsfpfzDlHkiQQQkBKCaUklSvyyuVVVTnY3MMes43jOMZ0OnUPmjOtjfMNrNmmnnh9RNy5RHrfgp6PQHyJCXdN/qaLCmmaIlqt6dag489x3Orjuh1CqwrLKHL1dhMva59jfHqAwcURvp7uYDlEywV6vT4+Zx/IthtkjCEIAnS7zzCqxM1tiMMzHydXAwhe0t0Q72FIgwW8WnKokuGbcWxZ7qhbZpwLlEXu9NrlHHlR0L4ab7OMmk7w8EKM6Q+UVFjEEfzJeL+G1qx2WmsHGxtjfrU0kFZX0nCTM4xWa/wAPRDGO93VjwsAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Tracing Architecture"
        title=""
        src="/static/571735106220a0a56f3c49713cc1083f/fcda8/architecture.png"
        srcset="/static/571735106220a0a56f3c49713cc1083f/12f09/architecture.png 148w,
/static/571735106220a0a56f3c49713cc1083f/e4a3f/architecture.png 295w,
/static/571735106220a0a56f3c49713cc1083f/fcda8/architecture.png 590w,
/static/571735106220a0a56f3c49713cc1083f/efc66/architecture.png 885w,
/static/571735106220a0a56f3c49713cc1083f/c83ae/architecture.png 1180w,
/static/571735106220a0a56f3c49713cc1083f/460fa/architecture.png 1910w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>The service, of which there can be many, is deployed using an agent (if available for the language and framework). This is then sending the tracing data (and metrics) to the OpenTelemetry collector, which has a configured pipeline to receive spans and forward them to the Jaeger collector, which stores it in a storage backend such as an Elasticsearch database. The Jaeger Query service allows an engineer to query the traces and visualize them.</p></section><hr style="margin-bottom:1.58rem"/><footer><div style="display:flex;margin-bottom:3.95rem"><div data-gatsby-image-wrapper="" style="width:50px;height:50px;margin-right:0.79rem;margin-bottom:0;min-width:50px;border-radius:100%" class="gatsby-image-wrapper"><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAQDBQb/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABtnujmt1K48zoD2wn/8QAGxAAAgIDAQAAAAAAAAAAAAAAAQIDEQAEEiH/2gAIAQEAAQUCI8Kurc41UB1JWPK7O8rg6zmSH//EABcRAQADAAAAAAAAAAAAAAAAABABMUH/2gAIAQMBAT8BijD/xAAWEQADAAAAAAAAAAAAAAAAAAABEDH/2gAIAQIBAT8BNRq//8QAHhAAAQQBBQAAAAAAAAAAAAAAAQACESEQEjEyUZH/2gAIAQEABj8CXOR1i0BfuNRNhBzTBhBzt1//xAAbEAACAwEBAQAAAAAAAAAAAAAAAREhMWFBcf/aAAgBAQABPyGKtPJFBq1paMRXW86REobIYXWfDgx66VEOHwf/2gAMAwEAAgADAAAAEP8AGMH/xAAXEQEBAQEAAAAAAAAAAAAAAAABEBEx/9oACAEDAQE/ECaWHU//xAAXEQEBAQEAAAAAAAAAAAAAAAABEBEx/9oACAECAQE/EG4CcJ//xAAcEAEAAwACAwAAAAAAAAAAAAABABEhMUFRcbH/2gAIAQEAAT8QV1WIKXVtXMXgHRZgXxK8AWj2jcgvcF7EN7+TScqUVw9CXqAOI74mj6oooaZ//9k=" alt=""/><picture><source type="image/webp" data-srcset="/blog/static/b4ad523f144d7d9048b92d580ba7b53d/dbc4a/profile-pic.webp 50w,/blog/static/b4ad523f144d7d9048b92d580ba7b53d/d8057/profile-pic.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="border-radius:50%;opacity:0" sizes="50px" decoding="async" loading="lazy" data-src="/blog/static/b4ad523f144d7d9048b92d580ba7b53d/6ac16/profile-pic.jpg" data-srcset="/blog/static/b4ad523f144d7d9048b92d580ba7b53d/6ac16/profile-pic.jpg 50w,/blog/static/b4ad523f144d7d9048b92d580ba7b53d/e07e1/profile-pic.jpg 100w" alt="Sebastian Häni"/></picture><noscript><picture><source type="image/webp" srcSet="/blog/static/b4ad523f144d7d9048b92d580ba7b53d/dbc4a/profile-pic.webp 50w,/blog/static/b4ad523f144d7d9048b92d580ba7b53d/d8057/profile-pic.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="border-radius:50%;opacity:0" sizes="50px" decoding="async" loading="lazy" src="/blog/static/b4ad523f144d7d9048b92d580ba7b53d/6ac16/profile-pic.jpg" srcSet="/blog/static/b4ad523f144d7d9048b92d580ba7b53d/6ac16/profile-pic.jpg 50w,/blog/static/b4ad523f144d7d9048b92d580ba7b53d/e07e1/profile-pic.jpg 100w" alt="Sebastian Häni"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><p>Written by <strong>Sebastian Häni</strong> <!-- -->who lives, studies and works in Zurich building useful things.<!-- --> <a href="https://sebastianhaeni.ch" rel="noopener noreferrer" target="_blank">You can find his social links on his personal website.</a></p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/blog/0011-opentelemetry-intro/">← <!-- -->OpenTelemetry Introduction</a></li><li><a rel="next" href="/blog/0015-maven-dependency-tree/">Maven Dependency Tree<!-- --> →</a></li></ul></nav><div id="disqus_thread"></div></main><footer style="margin-top:4.74rem;text-align:center;font-size:0.79rem">© <!-- -->2024<!-- --> Sebastian Häni</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-GPRW5X1NBT"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-GPRW5X1NBT', {"send_page_view":false});
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/0012-distributed-tracing/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-d6c2844652305c0e91fc.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-480c1a4dd32e38cdc8ef.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-70424471edbf3960c136.js\"],\"component---src-pages-tags-js\":[\"/component---src-pages-tags-js-51aa83272acad590c696.js\"],\"component---src-templates-blog-post-js\":[\"/component---src-templates-blog-post-js-d25c5acebbaee161b916.js\"],\"component---src-templates-tags-js\":[\"/component---src-templates-tags-js-4c805fd4ecd6a3457042.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="aa5c8f87dc0342e41fdd";</script><script src="/blog/webpack-runtime-585cec036683850c8a7e.js" async></script><script src="/blog/framework-f558bc4879ae61937dbc.js" async></script><script src="/blog/app-d6c2844652305c0e91fc.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>